&НаКлиенте
Процедура Сформировать(Команда)
	ТабДок = СформироватьТабДок();
	ТабДок.Показать();
КонецПроцедуры

&НаСервере
Функция СформироватьТабДок()
	Макет = Отчеты.Отчет3.ПолучитьМакет("Макет");
	Запрос = Новый Запрос;
	Запрос.Текст =
	"ВЫБРАТЬ
	| ИсторияПокупок.Товар КАК Товар,
	| ИсторияПокупок.Сумма КАК Сумма,
	| ИсторияПокупок.Количество КАК Количество
	|ИЗ
	| РегистрСведений.ИсторияПокупок.СрезПоследних(&Дата1) КАК ИсторияПокупок";
	
	Запрос.УстановитьПараметр("Дата1", Период);
	РезультатЗапроса = Запрос.Выполнить();
	Выборка = РезультатЗапроса.Выбрать();
		
	ОбластьЗаголовок = Макет.ПолучитьОбласть("Заголовок");
	ОбластьШапкаТаблицы = Макет.ПолучитьОбласть("ШапкаТаблицы");
	ОбластьДетальныхЗаписей = Макет.ПолучитьОбласть("СтрокаТаблицы");
	
	ТабДок = Новый ТабличныйДокумент;
	ТабДок.Очистить();
	ОбластьЗаголовок.Параметры.Дата1 = Формат(Период, "ДЛФ=DD");
	ТабДок.Вывести(ОбластьЗаголовок);
	ТабДок.Вывести(ОбластьШапкаТаблицы);
	ИтогоКоличество = 0;
	ИтогоСумма = 0;
	
	Пока Выборка.Следующий() Цикл
		ОбластьДетальныхЗаписей.Параметры.Заполнить(Выборка);
		ТабДок.Вывести(ОбластьДетальныхЗаписей);
	КонецЦикла;

	Возврат ТабДок;
КонецФункции
