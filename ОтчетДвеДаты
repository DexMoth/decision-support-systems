
&НаКлиенте
Процедура Сформировать(Команда)
	ТабДок = СформироватьТабДок();
	ТабДок.Показать();
КонецПроцедуры

&НаСервере
Функция СформироватьТабДок()
	Макет = Отчеты.Отчет2.ПолучитьМакет("Макет");
	Запрос = Новый Запрос;
	Запрос.Текст =
	"ВЫБРАТЬ
	| ОборотыТовара.Товар КАК Товар,
	| ОборотыТовара.СуммаОборот КАК Сумма
	|ИЗ
	| РегистрНакопления.ОборотыТовара.Обороты(&Дата1, &Дата2) КАК ОборотыТовара
	|
	|СГРУППИРОВАТЬ ПО
	| ОборотыТовара.Товар, ОборотыТовара.СуммаОборот"; 
	
	Запрос.УстановитьПараметр("Дата1", ДатаНачала);
	Запрос.УстановитьПараметр("Дата2", ДатаОкончания);
	РезультатЗапроса = Запрос.Выполнить();
	Выборка = РезультатЗапроса.Выбрать();

	ОбластьЗаголовок = Макет.ПолучитьОбласть("Заголовок");
	ОбластьШапкаТаблицы = Макет.ПолучитьОбласть("Шапка");
	ОбластьДетальныхЗаписей = Макет.ПолучитьОбласть("Строка");
	
	ТабДок = Новый ТабличныйДокумент;
	ТабДок.Очистить();
	ОбластьЗаголовок.Параметры.Дата1 = Формат(ДатаНачала, "ДЛФ=DD");
	ОбластьЗаголовок.Параметры.Дата2 = Формат(ДатаОкончания, "ДЛФ=DD");
	ТабДок.Вывести(ОбластьЗаголовок);
	ТабДок.Вывести(ОбластьШапкаТаблицы);
	ИтогоКоличество = 0;
	ИтогоСумма = 0;
	
	Пока Выборка.Следующий() Цикл
	ОбластьДетальныхЗаписей.Параметры.Заполнить(Выборка);
	ТабДок.Вывести(ОбластьДетальныхЗаписей);
	КонецЦикла;

	Возврат ТабДок;
КонецФункции
