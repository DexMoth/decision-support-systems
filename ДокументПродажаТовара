// Документ: Продажа Товара//

// Считается общая сумма товаров в табличной части
&НаКлиенте
Процедура ПересчитатьСумму()  
  	Стр = Элементы.Позиции.ТекущиеДанные;
  	Если Стр = Неопределено Тогда
      	Возврат;
  	КонецЕсли;
  	Стр.Стоимость = Стр.Цена * Стр.Количество;
	Сообщить(Стр.Стоимость);
	Сообщить(Стр.Цена);
	Сообщить(Стр.Товар);
	Сообщить(Стр.Количество);
	
	Сумма = 0;
 	Для Каждого с из Объект.Позиции Цикл
    	Сумма = Сумма + с.Стоимость;
  	КонецЦикла;
  
  	Объект.Сумма = Сумма;
	
  	Элементы.Позиции.Обновить();
КонецПроцедуры

// Когда изменили элемент
&НаКлиенте
Процедура ПозицииКоличествоПриИзменении(Элемент)
	ПересчитатьСумму();
КонецПроцедуры

&НаКлиенте
Процедура ПозицииТоварПриИзменении(Элемент)
	Стр = Объект.Позиции.НайтиПоИдентификатору(Элементы.Позиции.ТекущиеДанные.ПолучитьИдентификатор());
	Стр.Цена = ПолучитьТовар(Стр.Товар);
	ПересчитатьСумму();
КонецПроцедуры

&НаСервере
Функция ПолучитьТовар(Название)
 	Возврат Справочники.Товары.НайтиПоНаименованию(Название).Цена;
КонецФункции

&НаСервере
Функция печатьНаСервере()
	Док = Новый ТабличныйДокумент;
	Макет = Документы.ПродажаТовара.ПолучитьМакет("Макет");
	
	Шапка = Макет.ПолучитьОбласть("Шапка");   
	//Шапка.Параметры.Дата = Объект.Дата;
	Шапка.Параметры.Клиент = Объект.Клиент;
	Шапка.Параметры.АдресДоставки = Объект.АдресДоставки;
	Док.Вывести(Шапка);
	
	ШапкаТаблицы = Макет.ПолучитьОбласть("ШапкаТаблицы");
	Док.Вывести(ШапкаТаблицы);
	
	СтрокаТаблицы = Макет.ПолучитьОбласть("СтрокаТаблицы");
	
	ИтогКоличество = 0;
	ИтогСтоимость = 0;
	Для Каждого стрПозиция из Объект.Позиции Цикл
		СтрокаТаблицы.Параметры.Заполнить(стрПозиция);
	    Док.Вывести(СтрокаТаблицы);	    
		ИтогКоличество = ИтогКоличество + стрПозиция.Количество;
	КонецЦикла;

	ПодвалТаблицы = Макет.ПолучитьОбласть("ПодвалТаблицы");   
	ПодвалТаблицы.Параметры.ИтогКоличество = ИтогКоличество;
	ПодвалТаблицы.Параметры.ИтогСтоимость = Объект.Сумма;
	Док.Вывести(ПодвалТаблицы);

	Возврат Док;
КонецФункции

&НаКлиенте
Функция печать(Команда)
	печатьНаСервере().Показать("Продажа");
КонецФункции
